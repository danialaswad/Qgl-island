package fr.unice.polytech.qgl.qdd.ai.sequences.terrestrialsequences;

import fr.unice.polytech.qgl.qdd.Action;
import fr.unice.polytech.qgl.qdd.ai.CheckList;
import fr.unice.polytech.qgl.qdd.ai.sequences.Sequences;
import fr.unice.polytech.qgl.qdd.enums.Resource;
import fr.unice.polytech.qgl.qdd.navigation.Navigator;

import java.util.*;

/**
 * Created by danial on 26/12/15.
 */
public class ExploitSequence extends Sequences {
    
    public ExploitSequence(Navigator nav, CheckList checkList, Map<Resource, Integer> contractedResources,
                           Map<Resource, Integer> collectedResources) {
        super(nav, checkList);
    }

    @Override
    public Action execute() {
        return exploit(selectResourcesToExploit());
    }

    @Override
    public boolean completed() {
        return !checkList.exploitableResourceFound();
    }

    public List<Resource> selectResourcesToExploit() {
        List<Resource> availableResources = new ArrayList<>();

        nav.map().currentTile().getResources().keySet().stream()
                .filter( checkList.getResourcesToCollect()::contains )
                .forEach( availableResources::add );

        return availableResources;
    }
}
